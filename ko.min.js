const ko=(()=>{function a(a,b){const c=a instanceof HTMLElement?b?a.content:a:b?document.getElementById(a).content:document.getElementById(a),d={},f={},g={},h=[c],j=[],k=/{{(.+)}}/;for(let c,i,l,n,o,p,m=!0;h.length;){if(c=h.pop(),(l=c.nodeValue)&&(p=l.match(k))&&(f[p[1]]=f[p[1]]||[]).push([[...j],["nodeValue"],"IDENTITY"]),c.attributes){let a=[];for(let b=0;b<c.attributes.length;b++){if(n=c.attributes[b].name,o=c.attributes[b].value,"contenteditable"==n&&(p=c.innerText.match(k))&&(d[p[1]]=d[p[1]]||[]).push({input:[...j,"innerText"]}),"value"==n&&(p=o.match(k))&&((d[p[1]]=d[p[1]]||[]).push({keyup:[...j,"value"]}),(f[p[1]]=f[p[1]]||[]).push([[...j],["value"],"IDENTITY"])),"checked"==n&&(p=o.match(k))&&((d[p[1]]=d[p[1]]||[]).push({change:[...j,"checked"]}),(f[p[1]]=f[p[1]]||[]).push([[...j],["checked"],"IDENTITY"]),a.push("checked")),"data-ev"==n){let a,b,c,d=o.split(";");for(const e of d)a=e.split(":"),b=a[0].trim(),c=a[1].trim(),(g[c]=g[c]||[]).push([b,[...j]])}if("data-hide"==n&&(f[o]=f[o]||[]).push([[...j],["style","display"],"DATA_HIDE"]),"data-if"==n){let a=o.split(":"),b=a[0].trim(),c=a[1].trim();(f[a[0].trim()]=f[a[0].trim()]||[]).push([[...j],["style","display"],"DATA_IF"])}if("data-tagname"==n&&(f[o]=f[o]||[]).push([[...j],["tagName"],"CHANGE_TAGNAME"]),"data-attrs"==n){let a,b,c,d=o.split(";");for(const e of d)a=e.split(":").map(a=>a.trim()),b=a[0],c=a[1],(f[c]=f[c]||[]).push([[...j],[b],"IDENTITY"])}"data-innerhtml"==n&&(f[o]=f[o]||[]).push([[...j],["innerHTML"],"IDENTITY"]),(p=o.match(k))&&"value"!=n&&"checked"!=n&&(f[p[1]]=f[p[1]]||[]).push([[...j],["attributes",n,"value"],"IDENTITY"]),"data-foreach"==n&&((f[o]=f[o]||[]).push([[...j],["nodeValue"],"IDENTITY"]),m=!1)}for(const b of a)c.removeAttribute(b)}if((i=c.childNodes.length)&&m)j.push(e,i-1);else{for(;0==j[j.length-1];)j.pop(),j.pop();j[j.length-1]-=1}m?h.push(...c.childNodes):m=!0}return{DOMRef:c,isTmpl:b,mappings:f,bindings:d,events:g}}function b(a,b,c,d,e){if("tagName"==b[0]){const f=a;a=g[c](e,a,b,d),d.rebindSubs(f,a)}else{let f=a,h=0;for(;h<b.length-1;h++)f=f[b[h]];f[b[h]]=g[c](e,a,b,d)}}function c(b,c,e){const f=b.isTmpl?document.importNode(b.DOMRef,!0):b.DOMRef;for(const h in b.mappings){if(c[h]instanceof j){let g;for(const i of b.mappings[h]){const b=i[0];let j=f;for(let a=0;a<b.length;a++)j=j[b[a]];g=document.createElement("template"),document.head.appendChild(g),g.content.appendChild(j.children[0]),d(j,a(g,!0),c[h],e)}continue}let k,l,m,n;for(const a of b.mappings[h]){let b=c;lastKey=h,pair=h.split(":"),vmref=pair[0].split("."),lastKey=vmref.pop();for(const a of vmref)b=b[a];let d=f;k=a[0],l=a[1],m=a[2];for(let a=0;a<k.length;a++)d=d[k[a]];if("tagName"==l[0])d=g[m](b[lastKey],d,l,b);else{n=d;let a=0;for(;a<l.length-1;a++)n=n[l[a]];n[l[a]]=g[m](b[lastKey],d,l,b)}if(b.subscribeDOM(lastKey,d,l,m),1<pair.length){vmref=pair[1].split("."),lastKey=vmref.pop(),vm2=c;for(const a of vmref)vm2=vm2[a];vm2.subscribeDOM(lastKey,d,l,m,b)}}}for(const a in b.bindings)for(const d of b.bindings[a])for(const b in d){let e=f,g=d[b],h=g[g.length-1];for(let a=0;a<g.length-1;a++)e=e[g[a]];"input"==b&&"INPUT"!==e.nodeName&&e.addEventListener(b,b=>c[a]=b.target.innerText),"INPUT"===e.nodeName&&e.addEventListener(b,b=>c[a]=b.target[h])}for(const a in b.events)for(const d of b.events[a]){let b=f;ev=d[0],addr=d[1];for(const a of addr)b=b[a];a in e&&b.addEventListener(ev,e[a].bind(void 0,c))}return f}function d(a,b,c,d){return new k(a,b,c,d)}const e="childNodes",f=function(a,b,c,d,e){const f=b.attributes[e].value,g=f.split(":").map(a=>a.trim());let h=g[0].split("."),i=h.pop(),j=d;for(const f of h)j=j[f];let k;if(k=g[1].match(/'(.+)'/))return j[i]==k[1]?"":"none";else{h=g[1].split(".");let a=h.pop(),b=d;for(const a of h)b=b[a];return j[i]==b[a]?"":"none"}},g={IDENTITY:a=>a,DATA_IF:(a,b,c,d)=>f(a,b,c,d,"data-if")?"none":"",DATA_HIDE:(a,b,c,d)=>f(a,b,c,d,"data-hide")?"":"none",CHANGE_TAGNAME:(a,b)=>{const c=document.createElement(a),d=b.attributes["data-attrs"].value,e=d.split(";");let f,g;for(const d of e)f=d.split(":"),g=f[0].trim(),c[g]=b[g];for(const d of b.attributes)c.setAttribute(d.name,d.value);for(const d of b.childNodes)c.appendChild(d);return b.parentNode.replaceChild(c,b),c}};class h{constructor(a,b){for(const c in this._parent=b,this._data={},this._subs={},this._subsDOM={},this._refs=[],this._parentRefWrapper=this.$parent?new i(this.$parent,this):void 0,this._setup=!0,a){if(this._data[c]=a[c],this._subs[c]=[],"function"==typeof a[c]){let b=a[c](this);"object"==typeof b&&(this.unsubscribe(this._data[c]),b=Array.isArray(b)?new j(b,this):new h(b,this),b._subsDOM={...this._data[c]._subsDOM},b._subs={...this._data[c]._subs}),this._data[c]=b;let d=this;for(const b of this._refs)"_parent"===b?d=d.$parent:(d.subscribe(b,this,this.updateComputed(c,a[c])),d=this);this._refs=[]}"object"==typeof a[c]&&(Array.isArray(a[c])?this._data[c]=new j(a[c],this):this._data[c]=new h(a[c],this)),Object.defineProperty(this,c,{set:a=>{const b=this._data[c];this._data[c]=a,this.update(c,a,b)},get:()=>(this._setup&&this._refs.push(c),this._data[c])})}this._setup=!1,delete this._parentRefWrapper}set _parent(a){this.$parent=a}get _parent(){return this._setup?(this._refs.push("_parent"),this._parentRefWrapper):this.$parent}updateComputed(a,b){return()=>{let c=b(this);if("object"==typeof c){for(const a in c=Array.isArray(c)?new j(c,this):new h(c,this),c._subsDOM={...this._data[a]._subsDOM},c._subs={...this._data[a]._subs},c._data)c.update(a,c[a],null);delete this._data[a],this._data[a]=c}else this[a]=c}}subscribe(a,b,c){(this._subs[a]=this._subs[a]||[]).push([b,c])}unsubscribe(a){for(const b in this._subs)this._subs[b]=this._subs[b].filter(b=>b[0]!==a)}subscribeDOM(a,b,c,d,e){(this._subsDOM[a]=this._subsDOM[a]||[]).push([b,c,d,e||this])}rebindSubs(a,b){for(const c in this._subsDOM)for(const d of this._subsDOM[c])d[0]===a&&(d[0]=b)}update(a,c,d){if(c===d,a in this._subsDOM)for(const e of this._subsDOM[a])b(...e,c,d);if(a in this._subs)for(let b=0;b<this._subs[a].length;b++)this._subs[a][b][1](c,d,this)}}class i{constructor(a,b){for(const c in this.parentObj=a,this.child=b,a._data)Object.defineProperty(this,c,{set:a=>{this.parentObj._data[c]=a},get:()=>(this.child._refs.push(c),this.parentObj._data[c])})}}class j{constructor(a,b){this._parent=b,this._items=[],this._index=0,this._subs={push:[],insertAt:[],remove:[],all:[]};for(let c=0;c<a.length;c++)this._items.push(new h(a[c],this._parent)),this._defProp(c)}[Symbol.iterator](){return{next:()=>this._index<this._items.length?{value:this._items[this._index++],done:!1}:(this._index=0,{done:!0})}}subscribe(a,b,c){(this._subs[a]=this._subs[a]||[]).push([b,c])}_notify(a,...b){for(const c of this._subs[a])c[1](...b);for(const c of this._subs.all)c[1](a,...b)}_defProp(a){Object.defineProperty(this,a,{get:()=>this._items[a],set:b=>{this.remove(a),this.insertAt(a,b)},configurable:!0})}get length(){return this._items.length}push(a){const b=new h(a,this._parent);this._items.push(b),this._notify("push",b),this._defProp(this._items.length-1)}indexOf(a){return this._items.indexOf(a)}insertAt(a,b){const c=new h(b,this._parent);this._items.splice(a,0,c),this._notify("insertAt",a,c),this._defProp(this._items.length-1)}move(){}remove(a){this._parent.unsubscribe(this._items[a]),this._items.splice(a,1),this._notify("remove",a),delete this[this._items.length]}sortBy(){}filter(){}}class k{constructor(a,b,d,e){this._DOMRef=a,this._tmpl=b,this._events=e;const f=document.createDocumentFragment();for(const g of d)f.appendChild(c(b,g,e));a.appendChild(f),d.subscribe("insertAt",this,this.insertAt.bind(this)),d.subscribe("push",this,this.push.bind(this)),d.subscribe("remove",this,this.remove.bind(this))}insertAt(a,b){const d=c(this._tmpl,b);this._DOMRef.insertBefore(d,this._DOMRef.children[a])}push(a){this._DOMRef.appendChild(c(this._tmpl,a,this._events))}remove(a){this._DOMRef.removeChild(this._DOMRef.children[a])}sort(){}}return{initTmpl:a,render:c,Observable:h,ObservableArray:j,DOMArrayWrapper:k,viewModel:function(a){return Array.isArray(a)?new j(a):new h(a)},renderArray:d}})();
