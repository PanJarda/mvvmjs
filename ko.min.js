let ko=(()=>{const t="childNodes",s=function(t,s,e,i,n){const h=s.attributes[n].value.split(":").map(t=>t.trim());let r,o=h[0].split("."),a=o.pop(),u=i;for(const t of o)u=u[t];if(r=h[1].match(/'(.+)'/))return u[a]==r[1]?"":"none";{let t=(o=h[1].split(".")).pop(),s=i;for(const t of o)s=s[t];return u[a]==s[t]?"":"none"}},e={IDENTITY:t=>t,DATA_IF:(t,e,i,n)=>s(0,e,0,n,"data-if")?"none":"",DATA_HIDE:(t,e,i,n)=>s(0,e,0,n,"data-hide")?"":"none",CHANGE_TAGNAME:(t,s)=>{const e=document.createElement(t),i=s.attributes["data-attrs"].value.split(";");let n,h;for(const t of i)e[h=(n=t.split(":"))[0].trim()]=s[h];for(const t of s.attributes)e.setAttribute(t.name,t.value);for(const t of s.childNodes)e.appendChild(t);return s.parentNode.replaceChild(e,s),e}};function i(s,e){const i=s instanceof HTMLElement?e?s.content:s:e?document.getElementById(s).content:document.getElementById(s),n={},h={},r={},o=[i],a=[],u=/{{(.+)}}/;let p,l,c,d,f,_,b=!0;for(;o.length;){if((c=(p=o.pop()).nodeValue)&&(_=c.match(u))&&(h[_[1]]=h[_[1]]||[]).push([[...a],["nodeValue"],"IDENTITY"]),p.attributes){let t=[];for(let s=0;s<p.attributes.length;s++){if(d=p.attributes[s].name,f=p.attributes[s].value,"contenteditable"==d&&(_=p.innerText.match(u))&&(n[_[1]]=n[_[1]]||[]).push({input:[...a,"innerText"]}),"value"==d&&(_=f.match(u))&&((n[_[1]]=n[_[1]]||[]).push({keyup:[...a,"value"]}),(h[_[1]]=h[_[1]]||[]).push([[...a],["value"],"IDENTITY"])),"checked"==d&&(_=f.match(u))&&((n[_[1]]=n[_[1]]||[]).push({change:[...a,"checked"]}),(h[_[1]]=h[_[1]]||[]).push([[...a],["checked"],"IDENTITY"]),t.push("checked")),"data-ev"==d){let t,s,e,i=f.split(";");for(const n of i)s=(t=n.split(":"))[0].trim(),(r[e=t[1].trim()]=r[e]||[]).push([s,[...a]])}if("data-hide"==d&&(h[f]=h[f]||[]).push([[...a],["style","display"],"DATA_HIDE"]),"data-if"==d){let t=f.split(":");t[0].trim(),t[1].trim();(h[t[0].trim()]=h[t[0].trim()]||[]).push([[...a],["style","display"],"DATA_IF"])}if("data-tagname"==d&&(h[f]=h[f]||[]).push([[...a],["tagName"],"CHANGE_TAGNAME"]),"data-attrs"==d){let t,s,e,i=f.split(";");for(const n of i)s=(t=n.split(":").map(t=>t.trim()))[0],(h[e=t[1]]=h[e]||[]).push([[...a],[s],"IDENTITY"])}"data-innerhtml"==d&&(h[f]=h[f]||[]).push([[...a],["innerHTML"],"IDENTITY"]),(_=f.match(u))&&"value"!=d&&"checked"!=d&&(h[_[1]]=h[_[1]]||[]).push([[...a],["attributes",d,"value"],"IDENTITY"]),"data-foreach"==d&&((h[f]=h[f]||[]).push([[...a],["nodeValue"],"IDENTITY"]),b=!1)}for(const s of t)p.removeAttribute(s)}if((l=p.childNodes.length)&&b)a.push(t,l-1);else{for(;0==a[a.length-1];)a.pop(),a.pop();a[a.length-1]-=1}b?o.push(...p.childNodes):b=!0}let m={DOMRef:i,isTmpl:e,mappings:h,bindings:n,events:r};return console.log(h),m}function n(t,s,i,n,h,r){if("tagName"==s[0]){const r=t;t=e[i](h,t,s,n),n.rebindSubs(r,t)}else{let r=t,o=0;for(;o<s.length-1;o++)r=r[s[o]];r[s[o]]=e[i](h,t,s,n)}}function h(t,s,n){const h=t.isTmpl?document.importNode(t.DOMRef,!0):t.DOMRef;for(const r in t.mappings){if(s[r]instanceof a){let e;for(const o of t.mappings[r]){const t=o[0];let a=h;for(let s=0;s<t.length;s++)a=a[t[s]];e=document.createElement("template"),document.head.appendChild(e),e.content.appendChild(a.children[0]),p(a,i(e,!0),s[r],n)}continue}let o,u,l,c;for(const i of t.mappings[r]){let t=s,n=r,a=r.split(":"),p=a[0].split(".");n=p.pop();for(const s of p)t=t[s];let d=h;o=i[0],u=i[1],l=i[2];for(let t=0;t<o.length;t++)d=d[o[t]];if("tagName"==u[0])d=e[l](t[n],d,u,t);else{c=d;let s=0;for(;s<u.length-1;s++)c=c[u[s]];c[u[s]]=e[l](t[n],d,u,t)}if(t.subscribeDOM(n,d,u,l),a.length>1){n=(p=a[1].split(".")).pop(),vm2=s;for(const t of p)vm2=vm2[t];vm2.subscribeDOM(n,d,u,l,t)}}}for(const e in t.bindings)for(const i of t.bindings[e])for(const t in i){let n=h,r=i[t],o=r[r.length-1];for(let t=0;t<r.length-1;t++)n=n[r[t]];"input"===t&&"INPUT"!==n.nodeName&&n.addEventListener(t,t=>s[e]=t.target.innerText),"INPUT"===n.nodeName&&n.addEventListener(t,t=>s[e]=t.target[o])}for(const e in t.events)for(const i of t.events[e]){let t=h;ev=i[0],addr=i[1];for(const s of addr)t=t[s];e in n&&t.addEventListener(ev,n[e].bind(void 0,s))}return h}class r{constructor(t,s){this._parent=s,this._data={},this._subs={},this._subsDOM={},this._refs=[],this._parentRefWrapper=this.$parent?new o(this.$parent,this):void 0,this._setup=!0;for(const s in t){if(this._data[s]=t[s],this._subs[s]=[],"function"==typeof t[s]){let e=t[s](this);"object"==typeof e&&(this.unsubscribe(this._data[s]),(e=Array.isArray(e)?new a(e,this):new r(e,this))._subsDOM=Object.assign({},this._data[s]._subsDOM),e._subs=Object.assign({},this._data[s]._subs)),this._data[s]=e;let i=this;for(const e of this._refs)"_parent"===e?i=i.$parent:(i.subscribe(e,this,this.updateComputed(s,t[s])),i=this);this._refs=[]}"object"==typeof t[s]&&(Array.isArray(t[s])?this._data[s]=new a(t[s],this):this._data[s]=new r(t[s],this)),Object.defineProperty(this,s,{set:t=>{const e=this._data[s];this._data[s]=t,this.update(s,t,e)},get:()=>(this._setup&&this._refs.push(s),this._data[s])})}this._setup=!1,delete this._parentRefWrapper}set _parent(t){this.$parent=t}get _parent(){return this._setup?(this._refs.push("_parent"),this._parentRefWrapper):this.$parent}updateComputed(t,s){return()=>{let e=s(this);if("object"==typeof e){(e=Array.isArray(e)?new a(e,this):new r(e,this))._subsDOM=Object.assign({},this._data[t]._subsDOM),e._subs=Object.assign({},this._data[t]._subs);for(const t in e._data)e.update(t,e[t],null);delete this._data[t],this._data[t]=e}else this[t]=e}}subscribe(t,s,e){(this._subs[t]=this._subs[t]||[]).push([s,e])}unsubscribe(t){for(const s in this._subs)this._subs[s]=this._subs[s].filter(s=>s[0]!==t)}subscribeDOM(t,s,e,i,n){(this._subsDOM[t]=this._subsDOM[t]||[]).push([s,e,i,n||this])}rebindSubs(t,s){for(const e in this._subsDOM)for(const i of this._subsDOM[e])i[0]===t&&(i[0]=s)}update(t,s,e){if(t in this._subsDOM)for(const i of this._subsDOM[t])n(...i,s,e);if(t in this._subs)for(let i=0;i<this._subs[t].length;i++)this._subs[t][i][1](s,e,this)}}class o{constructor(t,s){this.parentObj=t,this.child=s;for(const s in t._data)Object.defineProperty(this,s,{set:t=>{this.parentObj._data[s]=t},get:()=>(this.child._refs.push(s),this.parentObj._data[s])})}}class a{constructor(t,s){this._parent=s,this._items=[],this._index=0,this._subs={push:[],insertAt:[],remove:[],all:[]};for(let s=0;s<t.length;s++)this._items.push(new r(t[s],this._parent)),this._defProp(s)}[Symbol.iterator](){return{next:()=>this._index<this._items.length?{value:this._items[this._index++],done:!1}:(this._index=0,{done:!0})}}subscribe(t,s,e){(this._subs[t]=this._subs[t]||[]).push([s,e])}_notify(t,...s){for(const e of this._subs[t])e[1](...s);for(const e of this._subs.all)e[1](t,...s)}_defProp(t){Object.defineProperty(this,t,{get:()=>this._items[t],set:s=>{this.remove(t),this.insertAt(t,s)},configurable:!0})}get length(){return this._items.length}push(t){const s=new r(t,this._parent);this._items.push(s),this._notify("push",s),this._defProp(this._items.length-1)}indexOf(t){return this._items.indexOf(t)}insertAt(t,s){const e=new r(s,this._parent);this._items.splice(t,0,e),this._notify("insertAt",t,e),this._defProp(this._items.length-1)}move(t,s){}remove(t){this._parent.unsubscribe(this._items[t]),this._items.splice(t,1),this._notify("remove",t),delete this[this._items.length]}sortBy(t,s){}filter(t){}}class u{constructor(t,s,e,i){this._DOMRef=t,this._tmpl=s,this._events=i;const n=document.createDocumentFragment();for(const t of e)n.appendChild(h(s,t,i));t.appendChild(n),e.subscribe("insertAt",this,this.insertAt.bind(this)),e.subscribe("push",this,this.push.bind(this)),e.subscribe("remove",this,this.remove.bind(this))}insertAt(t,s){const e=h(this._tmpl,s);this._DOMRef.insertBefore(e,this._DOMRef.children[t])}push(t){this._DOMRef.appendChild(h(this._tmpl,t,this._events))}remove(t){this._DOMRef.removeChild(this._DOMRef.children[t])}sort(){}}function p(t,s,e,i){return new u(t,s,e,i)}})()
