const ko=(()=>{function a(a){this.node[this.prop]=this.fn(a)}function b(b,c,d){const e=document.importNode(b.DOMRef,!0);for(const f in b.mappings){let d,g;for(const h of b.mappings[f]){let b=e;d=h[h.length-2],g=h[h.length-1];for(let a=0;a<h.length-2;a++)b=b[h[a]];b[d]=g(c[f]),c.subscribe(f,a.bind({node:b,prop:d,fn:g}))}}for(const a in b.bindings)for(const d of b.bindings[a])for(const b in d){let f=e,g=d[b],h=g[g.length-1];for(let a=0;a<g.length-1;a++)f=f[g[a]];"input"==b&&"INPUT"!==f.nodeName&&f.addEventListener(b,b=>c[a]=b.target.innerText),"INPUT"===f.nodeName&&f.addEventListener(b,b=>c[a]=b.target[h])}for(const a in b.events)for(const f of b.events[a]){let b=e;ev=f[0],addr=f[1];for(const a of addr)b=b[a];a in d&&b.addEventListener(ev,d[a].bind(void 0,c))}return e}const c=a=>a,d=(a,b)=>a!==b;class e{constructor(a){for(const b in this._data={},this._subs={},this._refs=[],this._setup=!0,a){if(this._data[b]=a[b],this._subs[b]=[],"function"==typeof a[b]){this._data[b]=a[b](this);for(const c of this._refs)this.subscribe(c,this.updateComputed(b,a[b]));this._refs=[]}Object.defineProperty(this,b,{set:a=>{this._data[b]=a,this.update(b,a)},get:()=>(this._setup&&this._refs.push(b),this._data[b])})}this._setup=!1}updateComputed(a,b){return()=>this[a]=b(this._data)}subscribe(a,b){a in this._subs?this._subs[a].push(b):this._subs[a]=[b]}update(a,b){this._subs[a].forEach(a=>a(b))}}class f{constructor(a){this._items=[],this._index=0,this._subs={push:[],insertAt:[],remove:[],all:[]};for(let b=0;b<a.length;b++)this._items.push(new e(a[b])),this._defProp(b)}[Symbol.iterator](){return{next:()=>this._index<this._items.length?{value:this._items[this._index++],done:!1}:(this._index=0,{done:!0})}}subscribe(a,b){this._subs[a].push(b)}_notify(a,...b){for(const c of this._subs[a])c(...b);for(const c of this._subs.all)c(a,...b)}_defProp(a){Object.defineProperty(this,a,{get:()=>this._items[a],set:b=>{this.remove(a),this.insertAt(a,b)},configurable:!0})}get length(){return this._items.length}push(a){const b=new e(a);this._items.push(b),this._notify("push",b),this._defProp(this._items.length-1)}indexOf(a){return this._items.indexOf(a)}insertAt(a,b){const c=new e(b);this._items.splice(a,0,c),this._notify("insertAt",a,c),this._defProp(this._items.length-1)}move(){}remove(a){this._items.splice(a,1),this._notify("remove",a),delete this[this._items.length]}sortBy(){}filter(){}}class g{constructor(a,c,d,e){this._DOMRef=a,this._tmpl=c,this._events=e;const f=document.createDocumentFragment();for(const g of d)f.appendChild(b(c,g,e));a.appendChild(f),d.subscribe("insertAt",this.insertAt.bind(this)),d.subscribe("push",this.push.bind(this)),d.subscribe("remove",this.remove.bind(this))}insertAt(a,c){const d=b(this._tmpl,c);this._DOMRef.insertBefore(d,this._DOMRef.children[a])}push(a){this._DOMRef.appendChild(b(this._tmpl,a,this._events))}remove(a){this._DOMRef.removeChild(this._DOMRef.children[a])}sort(){}}return{initTmpl:function(a){const b=document.getElementById(a).content,e={},f={},g={},h=[b],j=[],k=/{{(.+)}}/;for(let b,i,l,n,o,p;h.length;){if(b=h.pop(),(l=b.nodeValue)&&(p=l.match(k))&&(f[p[1]]=f[p[1]]||[]).push([...j,"nodeValue",c]),b.attributes){let a=[];for(let h=0;h<b.attributes.length;h++){if(n=b.attributes[h].name,o=b.attributes[h].value,"contenteditable"==n&&(p=b.innerText.match(k))&&(e[p[1]]=e[p[1]]||[]).push({input:[...j,"innerText"]}),"value"==n&&(p=o.match(k))&&((e[p[1]]=e[p[1]]||[]).push({keyup:[...j,"value"]}),(f[p[1]]=f[p[1]]||[]).push([...j,"value",c])),"checked"==n&&(p=o.match(k))&&((e[p[1]]=e[p[1]]||[]).push({change:[...j,"checked"]}),(f[p[1]]=f[p[1]]||[]).push([...j,"checked",c]),a.push("checked")),"data-ev"==n){let a,b,c,d=o.split(";");for(const e of d)a=e.split(":"),b=a[0].trim(),c=a[1].trim(),(g[c]=g[c]||[]).push([b,[...j]])}if("data-hide"==n&&(f[o]=f[o]||[]).push([...j,"hidden",c]),"data-if"==n){let a=o.split(":");(f[a[0].trim()]=f[a[0].trim()]||[]).push([...j,"hidden",d.bind(void 0,a[1].trim())])}(p=o.match(k))&&"value"!=n&&"checked"!=n&&(f[p[1]]=f[p[1]]||[]).push([...j,"attributes",n,"value",c])}for(const c of a)b.removeAttribute(c)}if(i=b.childNodes.length)j.push("childNodes",i-1);else{for(;0==j[j.length-1];)j.pop(),j.pop();j[j.length-1]-=1}h.push(...b.childNodes)}return{DOMRef:b,mappings:f,bindings:e,events:g}},render:b,Observable:e,ObservableArray:f,DOMArrayWrapper:g,viewModel:function(a){return Array.isArray(a)?new f(a):new e(a)},renderArray:function(a,b,c,d){return new g(document.getElementById(a),b,c,d)}}})();
